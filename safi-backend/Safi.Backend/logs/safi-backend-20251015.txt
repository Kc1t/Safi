2025-10-15 19:23:41.257 -03:00 [INF] Executed DbCommand (706ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [SAFIDB];
2025-10-15 19:23:41.614 -03:00 [INF] Executed DbCommand (281ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [SAFIDB] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-10-15 19:23:41.713 -03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-15 19:23:42.081 -03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [DEPARTMENTS] (
    [ID_DEPARTMENTS] int NOT NULL IDENTITY,
    [NAME] nvarchar(100) NOT NULL,
    [DESCRIPTION] nvarchar(500) NULL,
    [IS_ACTIVE] bit NOT NULL,
    [CREATED_AT] datetime2 NOT NULL,
    CONSTRAINT [PK_DEPARTMENTS] PRIMARY KEY ([ID_DEPARTMENTS])
);
2025-10-15 19:23:42.094 -03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [ISSUE_TYPES] (
    [ID_ISSUE_TYPES] int NOT NULL IDENTITY,
    [NAME] nvarchar(100) NOT NULL,
    [DESCRIPTION] nvarchar(500) NULL,
    [IS_ACTIVE] bit NOT NULL,
    [CREATED_AT] datetime2 NOT NULL,
    CONSTRAINT [PK_ISSUE_TYPES] PRIMARY KEY ([ID_ISSUE_TYPES])
);
2025-10-15 19:23:42.108 -03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [USERS] (
    [ID_USERS] int NOT NULL IDENTITY,
    [NAME] nvarchar(100) NOT NULL,
    [EMAIL] nvarchar(150) NOT NULL,
    [ID_USER_TYPES] int NOT NULL,
    [ID_ANALYST_LEVELS] int NULL,
    [ID_DEPARTMENTS] int NULL,
    [CREATED_AT] datetime2 NOT NULL,
    CONSTRAINT [PK_USERS] PRIMARY KEY ([ID_USERS]),
    CONSTRAINT [FK_USERS_DEPARTMENTS_ID_DEPARTMENTS] FOREIGN KEY ([ID_DEPARTMENTS]) REFERENCES [DEPARTMENTS] ([ID_DEPARTMENTS]) ON DELETE SET NULL
);
2025-10-15 19:23:42.124 -03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [TICKETS] (
    [ID_TICKETS] int NOT NULL IDENTITY,
    [TITLE] nvarchar(255) NOT NULL,
    [DETAILING] nvarchar(max) NULL,
    [STATUS] nvarchar(max) NOT NULL,
    [PRIORITY] nvarchar(max) NOT NULL,
    [ID_ISSUE_TYPES] int NOT NULL,
    [ID_USERS] int NOT NULL,
    [ASSIGNED_TO] int NULL,
    [SUPPORT_LEVEL] int NOT NULL,
    [CREATED_AT] datetime2 NOT NULL,
    [UPDATED_AT] datetime2 NULL,
    [RESOLVED_AT] datetime2 NULL,
    CONSTRAINT [PK_TICKETS] PRIMARY KEY ([ID_TICKETS]),
    CONSTRAINT [FK_TICKETS_ISSUE_TYPES_ID_ISSUE_TYPES] FOREIGN KEY ([ID_ISSUE_TYPES]) REFERENCES [ISSUE_TYPES] ([ID_ISSUE_TYPES]) ON DELETE NO ACTION,
    CONSTRAINT [FK_TICKETS_USERS_ASSIGNED_TO] FOREIGN KEY ([ASSIGNED_TO]) REFERENCES [USERS] ([ID_USERS]) ON DELETE SET NULL,
    CONSTRAINT [FK_TICKETS_USERS_ID_USERS] FOREIGN KEY ([ID_USERS]) REFERENCES [USERS] ([ID_USERS]) ON DELETE NO ACTION
);
2025-10-15 19:23:42.155 -03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [TICKET_CHAT_HISTORY] (
    [ID_CHAT_HISTORY] int NOT NULL IDENTITY,
    [ID_TICKETS] int NOT NULL,
    [ID_USERS] int NOT NULL,
    [MESSAGE] nvarchar(2000) NOT NULL,
    [MESSAGE_TYPE] nvarchar(50) NOT NULL,
    [CREATED_AT] datetime2 NOT NULL,
    [IS_INTERNAL] bit NOT NULL,
    CONSTRAINT [PK_TICKET_CHAT_HISTORY] PRIMARY KEY ([ID_CHAT_HISTORY]),
    CONSTRAINT [FK_TICKET_CHAT_HISTORY_TICKETS_ID_TICKETS] FOREIGN KEY ([ID_TICKETS]) REFERENCES [TICKETS] ([ID_TICKETS]) ON DELETE CASCADE,
    CONSTRAINT [FK_TICKET_CHAT_HISTORY_USERS_ID_USERS] FOREIGN KEY ([ID_USERS]) REFERENCES [USERS] ([ID_USERS]) ON DELETE CASCADE
);
2025-10-15 19:23:42.187 -03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [TICKET_HISTORY] (
    [ID] int NOT NULL IDENTITY,
    [ID_TICKETS] int NOT NULL,
    [CHANGED_BY] int NOT NULL,
    [CHANGE_DESCRIPTION] nvarchar(max) NOT NULL,
    [CHANGED_AT] datetime2 NOT NULL,
    [CHANGE_TYPE] nvarchar(50) NOT NULL,
    [OLD_VALUE] nvarchar(500) NULL,
    [NEW_VALUE] nvarchar(500) NULL,
    CONSTRAINT [PK_TICKET_HISTORY] PRIMARY KEY ([ID]),
    CONSTRAINT [FK_TICKET_HISTORY_TICKETS_ID_TICKETS] FOREIGN KEY ([ID_TICKETS]) REFERENCES [TICKETS] ([ID_TICKETS]) ON DELETE CASCADE,
    CONSTRAINT [FK_TICKET_HISTORY_USERS_CHANGED_BY] FOREIGN KEY ([CHANGED_BY]) REFERENCES [USERS] ([ID_USERS]) ON DELETE NO ACTION
);
2025-10-15 19:23:42.206 -03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [TICKET_MESSAGES] (
    [ID] int NOT NULL IDENTITY,
    [ID_TICKETS] int NOT NULL,
    [ID_SENDER] int NOT NULL,
    [MESSAGE] nvarchar(max) NOT NULL,
    [CREATED_AT] datetime2 NOT NULL,
    [IS_INTERNAL] bit NOT NULL,
    [IS_AI_MESSAGE] bit NOT NULL,
    [MESSAGE_TYPE] nvarchar(50) NOT NULL,
    CONSTRAINT [PK_TICKET_MESSAGES] PRIMARY KEY ([ID]),
    CONSTRAINT [FK_TICKET_MESSAGES_TICKETS_ID_TICKETS] FOREIGN KEY ([ID_TICKETS]) REFERENCES [TICKETS] ([ID_TICKETS]) ON DELETE CASCADE,
    CONSTRAINT [FK_TICKET_MESSAGES_USERS_ID_SENDER] FOREIGN KEY ([ID_SENDER]) REFERENCES [USERS] ([ID_USERS]) ON DELETE NO ACTION
);
2025-10-15 19:23:42.221 -03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX [IX_DEPARTMENTS_NAME] ON [DEPARTMENTS] ([NAME]);
2025-10-15 19:23:42.233 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX [IX_ISSUE_TYPES_NAME] ON [ISSUE_TYPES] ([NAME]);
2025-10-15 19:23:42.245 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_TICKET_CHAT_HISTORY_ID_TICKETS] ON [TICKET_CHAT_HISTORY] ([ID_TICKETS]);
2025-10-15 19:23:42.263 -03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_TICKET_CHAT_HISTORY_ID_USERS] ON [TICKET_CHAT_HISTORY] ([ID_USERS]);
2025-10-15 19:23:42.277 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_TICKET_HISTORY_CHANGED_BY] ON [TICKET_HISTORY] ([CHANGED_BY]);
2025-10-15 19:23:42.294 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_TICKET_HISTORY_ID_TICKETS] ON [TICKET_HISTORY] ([ID_TICKETS]);
2025-10-15 19:23:42.311 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_TICKET_MESSAGES_ID_SENDER] ON [TICKET_MESSAGES] ([ID_SENDER]);
2025-10-15 19:23:42.327 -03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_TICKET_MESSAGES_ID_TICKETS] ON [TICKET_MESSAGES] ([ID_TICKETS]);
2025-10-15 19:23:42.339 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_TICKETS_ASSIGNED_TO] ON [TICKETS] ([ASSIGNED_TO]);
2025-10-15 19:23:42.352 -03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_TICKETS_ID_ISSUE_TYPES] ON [TICKETS] ([ID_ISSUE_TYPES]);
2025-10-15 19:23:42.365 -03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_TICKETS_ID_USERS] ON [TICKETS] ([ID_USERS]);
2025-10-15 19:23:42.379 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX [IX_USERS_EMAIL] ON [USERS] ([EMAIL]);
2025-10-15 19:23:42.398 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_USERS_ID_DEPARTMENTS] ON [USERS] ([ID_DEPARTMENTS]);
2025-10-15 19:23:42.837 -03:00 [INF] Executed DbCommand (48ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [DEPARTMENTS] AS [d]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-15 19:23:43.161 -03:00 [INF] Executed DbCommand (54ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 500), @p2='?' (DbType = Boolean), @p3='?' (Size = 100), @p4='?' (DbType = DateTime2), @p5='?' (Size = 500), @p6='?' (DbType = Boolean), @p7='?' (Size = 100), @p8='?' (DbType = DateTime2), @p9='?' (Size = 500), @p10='?' (DbType = Boolean), @p11='?' (Size = 100), @p12='?' (DbType = DateTime2), @p13='?' (Size = 500), @p14='?' (DbType = Boolean), @p15='?' (Size = 100), @p16='?' (DbType = DateTime2), @p17='?' (Size = 500), @p18='?' (DbType = Boolean), @p19='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [DEPARTMENTS] USING (
VALUES (@p0, @p1, @p2, @p3, 0),
(@p4, @p5, @p6, @p7, 1),
(@p8, @p9, @p10, @p11, 2),
(@p12, @p13, @p14, @p15, 3),
(@p16, @p17, @p18, @p19, 4)) AS i ([CREATED_AT], [DESCRIPTION], [IS_ACTIVE], [NAME], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([CREATED_AT], [DESCRIPTION], [IS_ACTIVE], [NAME])
VALUES (i.[CREATED_AT], i.[DESCRIPTION], i.[IS_ACTIVE], i.[NAME])
OUTPUT INSERTED.[ID_DEPARTMENTS], i._Position;
2025-10-15 19:23:43.250 -03:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 500), @p2='?' (DbType = Boolean), @p3='?' (Size = 100), @p4='?' (DbType = DateTime2), @p5='?' (Size = 500), @p6='?' (DbType = Boolean), @p7='?' (Size = 100), @p8='?' (DbType = DateTime2), @p9='?' (Size = 500), @p10='?' (DbType = Boolean), @p11='?' (Size = 100), @p12='?' (DbType = DateTime2), @p13='?' (Size = 500), @p14='?' (DbType = Boolean), @p15='?' (Size = 100), @p16='?' (DbType = DateTime2), @p17='?' (Size = 500), @p18='?' (DbType = Boolean), @p19='?' (Size = 100), @p20='?' (DbType = DateTime2), @p21='?' (Size = 500), @p22='?' (DbType = Boolean), @p23='?' (Size = 100), @p24='?' (DbType = DateTime2), @p25='?' (Size = 500), @p26='?' (DbType = Boolean), @p27='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [ISSUE_TYPES] USING (
VALUES (@p0, @p1, @p2, @p3, 0),
(@p4, @p5, @p6, @p7, 1),
(@p8, @p9, @p10, @p11, 2),
(@p12, @p13, @p14, @p15, 3),
(@p16, @p17, @p18, @p19, 4),
(@p20, @p21, @p22, @p23, 5),
(@p24, @p25, @p26, @p27, 6)) AS i ([CREATED_AT], [DESCRIPTION], [IS_ACTIVE], [NAME], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([CREATED_AT], [DESCRIPTION], [IS_ACTIVE], [NAME])
VALUES (i.[CREATED_AT], i.[DESCRIPTION], i.[IS_ACTIVE], i.[NAME])
OUTPUT INSERTED.[ID_ISSUE_TYPES], i._Position;
2025-10-15 19:23:43.373 -03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [d].[ID_DEPARTMENTS], [d].[CREATED_AT], [d].[DESCRIPTION], [d].[IS_ACTIVE], [d].[NAME]
FROM [DEPARTMENTS] AS [d]
WHERE [d].[NAME] = N'TI - Tecnologia da Informação'
2025-10-15 19:23:43.410 -03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [d].[ID_DEPARTMENTS], [d].[CREATED_AT], [d].[DESCRIPTION], [d].[IS_ACTIVE], [d].[NAME]
FROM [DEPARTMENTS] AS [d]
WHERE [d].[NAME] = N'RH - Recursos Humanos'
2025-10-15 19:23:43.435 -03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [d].[ID_DEPARTMENTS], [d].[CREATED_AT], [d].[DESCRIPTION], [d].[IS_ACTIVE], [d].[NAME]
FROM [DEPARTMENTS] AS [d]
WHERE [d].[NAME] = N'Comercial'
2025-10-15 19:23:43.565 -03:00 [INF] Executed DbCommand (33ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (Size = 150), @p4='?' (Size = 100), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime2), @p8='?' (DbType = Int32), @p9='?' (Size = 150), @p10='?' (Size = 100), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime2), @p14='?' (DbType = Int32), @p15='?' (Size = 150), @p16='?' (Size = 100), @p17='?' (DbType = Int32), @p18='?' (DbType = Int32), @p19='?' (DbType = DateTime2), @p20='?' (DbType = Int32), @p21='?' (Size = 150), @p22='?' (Size = 100), @p23='?' (DbType = Int32), @p24='?' (DbType = Int32), @p25='?' (DbType = DateTime2), @p26='?' (DbType = Int32), @p27='?' (Size = 150), @p28='?' (Size = 100), @p29='?' (DbType = Int32), @p30='?' (DbType = Int32), @p31='?' (DbType = DateTime2), @p32='?' (DbType = Int32), @p33='?' (Size = 150), @p34='?' (Size = 100), @p35='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [USERS] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, 0),
(@p6, @p7, @p8, @p9, @p10, @p11, 1),
(@p12, @p13, @p14, @p15, @p16, @p17, 2),
(@p18, @p19, @p20, @p21, @p22, @p23, 3),
(@p24, @p25, @p26, @p27, @p28, @p29, 4),
(@p30, @p31, @p32, @p33, @p34, @p35, 5)) AS i ([ID_ANALYST_LEVELS], [CREATED_AT], [ID_DEPARTMENTS], [EMAIL], [NAME], [ID_USER_TYPES], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([ID_ANALYST_LEVELS], [CREATED_AT], [ID_DEPARTMENTS], [EMAIL], [NAME], [ID_USER_TYPES])
VALUES (i.[ID_ANALYST_LEVELS], i.[CREATED_AT], i.[ID_DEPARTMENTS], i.[EMAIL], i.[NAME], i.[ID_USER_TYPES])
OUTPUT INSERTED.[ID_USERS], i._Position;
2025-10-15 19:23:43.599 -03:00 [INF] User profile is available. Using 'C:\Users\phmil\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-15 19:23:43.816 -03:00 [INF] Now listening on: http://localhost:5080
2025-10-15 19:23:43.823 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-15 19:23:43.825 -03:00 [INF] Hosting environment: Development
2025-10-15 19:23:43.827 -03:00 [INF] Content root path: C:\Users\phmil\OneDrive\Área de Trabalho\Pim\Safi\safi-backend\Safi.Backend
2025-10-15 20:55:21.789 -03:00 [INF] Application is shutting down...
2025-10-15 20:55:39.636 -03:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-15 20:55:39.873 -03:00 [INF] Executed DbCommand (182ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-15 20:55:40.107 -03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [DEPARTMENTS] AS [d]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-15 20:55:40.134 -03:00 [INF] User profile is available. Using 'C:\Users\phmil\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-15 20:55:40.219 -03:00 [INF] Now listening on: http://localhost:5080
2025-10-15 20:55:40.222 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-15 20:55:40.223 -03:00 [INF] Hosting environment: Development
2025-10-15 20:55:40.224 -03:00 [INF] Content root path: C:\Users\phmil\OneDrive\Área de Trabalho\Pim\Safi\safi-backend\Safi.Backend
2025-10-15 21:48:59.184 -03:00 [INF] Application is shutting down...
